{% extends 'base.html' %}

{% block title %}Cell line {{ cellline.name }}{% endblock %}

{% block article %}

<h1>{{ cellline.name }} <small>{{ cellline.biosamples_id }}</small></h1>

<div class="status">
    {% if cellline.accepted == 'accepted' or not perms.site.can_manage_executive_dashboard %}
    Status:
    {% else %}
    Change status:
    {% endif %}
    {% include 'executive/accepted-status.html' %}
</div>

<div class="batches">
    <h2>Batches</h2>

    <div class="request-bisample-ids"><a href="./">Request new batch and vial Biosample IDs</a></div>

    {% if cellline.batches.all|length %}
    <ul class="accordion">
    {% for batch in cellline.batches.all %}
    <li><a href="javascript:void(0)" class="js-accordion-trigger">{% if batch.batch_id == batch.biosamples_id %}{% else %}<b>{{ batch.batch_id }}</b> - {% endif %}{{ batch.biosamples_id }} <small>({{ batch.aliquots.all.count }} vials)</small> <i class="glyphicon glyphicon-chevron-down"></i></a>
        <div class="content">
        {% if batch.batch_id and batch.batch_id != batch.biosamples_id %}

            <p><b>Inventory</b><br/>
            Vials at Roslin: {{ batch.vials_at_roslin }}<br/>
            Vials shipped to ECACC: {{ batch.vials_shipped_to_ecacc }}<br/>
            Vials shipped to Fraunhoffer: {{ batch.vials_shipped_to_fraunhoffer }}</p>

            <p><b>Culture conditions</b><br/>
            Medium: {{ batch.batchcultureconditions.culture_medium }}<br/>
            Passage method: {{ batch.batchcultureconditions.passage_method }}<br/>
            Matrix: {{ batch.batchcultureconditions.matrix }}<br/>
            CO2 concentration: {{ batch.batchcultureconditions.co2_concentration }}<br/>
            O2 concentration: {{ batch.batchcultureconditions.o2_concentration }}<br/>
            Temperature: {{ batch.batchcultureconditions.temperature }}<br/>

        {% else %}
        <p><span class="comment">No data available.</span></p>
        {% endif %}

        <div class="link-to-biosample-ids-file"><a href="{% url 'executive:batch_data' cellline.biosamples_id batch.biosamples_id %}"><i class="glyphicon glyphicon-download"></i>Download vial Biosample IDs file</a></div>
        </div>
    </li>
    {% endfor%}
    </ul>
    {% else %}
    <p><span class="comment">Cell line has no batches.</span></p>
    {% endif %}

</div>

{% include 'search/__cellline_data__.html' %}

{% endblock %}

{% block extra-scripts %}
{% if perms.site.can_manage_executive_dashboard %}
{% include 'executive/accepted-script.html' %}
{% endif %}
<script>
$('.js-accordion-trigger').bind('click', function(e){
  jQuery(this).parent().find('.content').slideToggle('fast');  // apply the toggle to the ul
  jQuery(this).parent().toggleClass('is-expanded');
  e.preventDefault();
});
</script>
{% endblock %}
