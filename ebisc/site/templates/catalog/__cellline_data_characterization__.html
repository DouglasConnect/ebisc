{% load thumbnail %}

<tr><th colspan="2" class="title" id="characterization"><h2>Characterization</h2></th></tr>

{% if cellline.celllinecharacterization.certificate_of_analysis_passage_number %}
<tr><td class="label">Certificate of analysis passage number:</td><td>{{ cellline.celllinecharacterization.certificate_of_analysis_passage_number|default:"-" }}</td></tr>
{% endif %}

<tr>
    <td class="label">Microbiology / Virology Screening:</td>
    <td>
        <table>
            <tr>
                <td>HIV 1:</td>
                <td>{{ cellline.celllinecharacterization.get_screening_hiv1_display|default:"-" }}</td>
            </tr>
            <tr>
                <td>HIV 2:</td>
                <td>{{ cellline.celllinecharacterization.get_screening_hiv2_display|default:"-" }}</td>
            </tr>
            <tr>
                <td>Hepatitis B:</td>
                <td>{{ cellline.celllinecharacterization.get_screening_hepatitis_b_display|default:"-" }}</td>
            </tr>
            <tr>
                <td>Hepatitis C:</td>
                <td>{{ cellline.celllinecharacterization.get_screening_hepatitis_c_display|default:"-" }}</td>
            </tr>
            <tr>
                <td>Mycoplasma:</td>
                <td>{{ cellline.celllinecharacterization.get_screening_mycoplasma_display|default:"-" }}</td>
            </tr>
        </table>
    </td>
</tr>

{% if cellline.undifferentiated_morphology_marker_imune or cellline.undifferentiated_morphology_marker_facs or cellline.undifferentiated_morphology_marker_rtpcr or cellline.undifferentiated_morphology_marker_morphology or cellline.undifferentiated_morphology_marker_expression_profile or cellline.celllinecharacterizationpluritest or cellline.celllinecharacterizationepipluriscore or cellline.undifferentiated_morphology_files.all %}
<tr><th class="sub-title"><h3>Undifferentiated cells</h3></th></tr>

<tr>
    <td class="label">Marker expression:</td>
    <td>
        {% if cellline.undifferentiated_morphology_marker_imune %}
        <p><b>Immune/Markerstaining</b><br/>
        Passage number: {{ cellline.undifferentiated_morphology_marker_imune.passage_number|default:'-' }}</p>
        <table>
        {% for molecule in cellline.undifferentiated_morphology_marker_imune.molecules.all %}
        <tr><td>{{ molecule.molecule }}:</td><td class="center">{{ molecule.result }}</td></tr>
        {% endfor %}
        </table>
        {% endif %}

        {% if cellline.undifferentiated_morphology_marker_facs %}
        <p><br/><b>FACS</b><br/>
        Passage number: {{ cellline.undifferentiated_morphology_marker_facs.passage_number|default:'-' }}</p>
        <table>
        {% for molecule in cellline.undifferentiated_morphology_marker_facs.molecules.all %}
        <tr><td>{{ molecule.molecule }}:</td><td class="center">{{ molecule.result }}</td></tr>
        {% endfor %}
        </table>
        {% endif %}

        {% if cellline.undifferentiated_morphology_marker_rtpcr %}
        <p><br/><b>RT-PCR</b><br/>
        Passage number: {{ cellline.undifferentiated_morphology_marker_rtpcr.passage_number|default:'-' }}</p>
        <table>
        {% for molecule in cellline.undifferentiated_morphology_marker_rtpcr.molecules.all %}
        <tr><td>{{ molecule.molecule }}:</td><td class="center">{{ molecule.result }}</td></tr>
        {% endfor %}
        </table>
        {% endif %}

        {% if cellline.undifferentiated_morphology_marker_morphology %}
        <p><br/><b>Morphology</b><br/>
        Passage number: {{ cellline.undifferentiated_morphology_marker_morphology.passage_number|default:'-' }}<br/>
        Description: {{ cellline.undifferentiated_morphology_marker_morphology.description|default:'-' }}<br/>
        {% if cellline.undifferentiated_morphology_marker_morphology.data_url %}
        File: <a href="{{ cellline.undifferentiated_morphology_marker_morphology.data_url }}">Image</a>
        {% endif %}
        {% endif %}

        {% if cellline.undifferentiated_morphology_marker_expression_profile %}
        <p><br/><b>Expression profiles (Omics)</b><br/>
        Passage number: {{ cellline.undifferentiated_morphology_marker_expression_profile.passage_number|default:'-' }}<br/>
        Method: {{ cellline.undifferentiated_morphology_marker_expression_profile.method|default:'-' }}<br/>
        <table>
        {% for molecule in undifferentiated_morphology_marker_expression_profile.molecules.all %}
        <tr><td>{{ molecule.molecule }}:</td><td class="center">{{ molecule.result }}</td></tr>
        {% endfor %}
        </table>
        Data:
        {% if undifferentiated_morphology_marker_expression_profile.uploaded_data_url %}
            <a href="{{ cellline.undifferentiated_morphology_marker_expression_profile.uploaded_data_url }}">Data file</a>
        {% endif %}
        {% if undifferentiated_morphology_marker_expression_profile.uploaded_data_url and cellline.undifferentiated_morphology_marker_expression_profile.data_url %}, {% endif %}
        {% if cellline.undifferentiated_morphology_marker_expression_profile.data_url %}
            <a href="{{ cellline.undifferentiated_morphology_marker_expression_profile.data_url }}">Link</a>
        {% endif %}
        {% endif %}

    </td>
</tr>

{% if cellline.celllinecharacterizationepipluriscore and cellline.celllinecharacterizationepipluriscore.score %}
<tr>
  <td class="label">EpiPluriScore:</td>
  <td>
    <p>Score: {{ cellline.celllinecharacterizationepipluriscore.score }}</p>

    <table class="bordered">
      <tr>
        <th>Marker</th>
        <th>Present</th>
        <th>Absent</th>
      </tr>
      <tr>
        <td>mCpG</td>
        {% if cellline.celllinecharacterizationepipluriscore.marker_mcpg == None %}
        <td></td>
        <td></td>
        {% else %}
          {% if cellline.celllinecharacterizationepipluriscore.marker_mcpg %}
          <td class="center"><i class="glyphicon glyphicon-ok success"></i></td>
          <td class="center"></td>
          {% else %}
          <td class="center"></td>
          <td class="center"><i class="glyphicon glyphicon-ok success"></i></td>
          {% endif %}
        {% endif %}
      </tr>
      <tr>
        <td>OCT4</td>
        {% if cellline.celllinecharacterizationepipluriscore.marker_OCT4 == None %}
        <td></td>
        <td></td>
        {% else %}
          {% if cellline.celllinecharacterizationepipluriscore.marker_OCT4 %}
          <td class="center"><i class="glyphicon glyphicon-ok success"></i></td>
          <td class="center"></td>
          {% else %}
          <td class="center"></td>
          <td class="center"><i class="glyphicon glyphicon-ok success"></i></td>
          {% endif %}
        {% endif %}
      </tr>
    </table>

    {% if cellline.celllinecharacterizationepipluriscore.epipluriscore_files.all %}
    <br/>Report: {% if not cellline.celllinecharacterizationepipluriscore.epipluriscore_files.all.count == 1 %}<br/>{% endif %}
    {% for report in cellline.celllinecharacterizationepipluriscore.epipluriscore_files.all %}
    <a href="{{ report.file_doc.url }}">{{ report.filename }}</a>{% if report.file_description %} - {{ report.file_description }}{% endif %}<br/>
    {% endfor %}
    {% endif %}
  </td>
</tr>
{% endif %}

{% if cellline.celllinecharacterizationhpscscorecard %}
<tr>
  <td class="label">hPSC Scorecard&trade;:</td>
  <td>
    <table class="bordered">
      <tr>
        <th></th>
        <th>Positive</th>
        <th>Negative</th>
      </tr>
      <tr>
        <td>Self-renewal</td>
        {% if cellline.celllinecharacterizationhpscscorecard.self_renewal == None %}
        <td></td>
        <td></td>
        {% else %}
          {% if cellline.celllinecharacterizationhpscscorecard.self_renewal %}
          <td class="center"><i class="glyphicon glyphicon-ok success"></i></td>
          <td class="center"></td>
          {% else %}
          <td class="center"></td>
          <td class="center"><i class="glyphicon glyphicon-ok success"></i></td>
          {% endif %}
        {% endif %}
      </tr>
      <tr>
        <td>Endoderm</td>
        {% if cellline.celllinecharacterizationhpscscorecard.endoderm == None %}
        <td></td>
        <td></td>
        {% else %}
          {% if cellline.celllinecharacterizationhpscscorecard.endoderm %}
          <td class="center"><i class="glyphicon glyphicon-ok success"></i></td>
          <td class="center"></td>
          {% else %}
          <td class="center"></td>
          <td class="center"><i class="glyphicon glyphicon-ok success"></i></td>
          {% endif %}
        {% endif %}
      </tr>
      <tr>
        <td>Mesoderm</td>
        {% if cellline.celllinecharacterizationhpscscorecard.mesoderm == None %}
        <td></td>
        <td></td>
        {% else %}
          {% if cellline.celllinecharacterizationhpscscorecard.mesoderm %}
          <td class="center"><i class="glyphicon glyphicon-ok success"></i></td>
          <td class="center"></td>
          {% else %}
          <td class="center"></td>
          <td class="center"><i class="glyphicon glyphicon-ok success"></i></td>
          {% endif %}
        {% endif %}
      </tr>
      <tr>
        <td>Ectoderm</td>
        {% if cellline.celllinecharacterizationhpscscorecard.ectoderm == None %}
        <td></td>
        <td></td>
        {% else %}
          {% if cellline.celllinecharacterizationhpscscorecard.ectoderm %}
          <td class="center"><i class="glyphicon glyphicon-ok success"></i></td>
          <td class="center"></td>
          {% else %}
          <td class="center"></td>
          <td class="center"><i class="glyphicon glyphicon-ok success"></i></td>
          {% endif %}
        {% endif %}
      </tr>
    </table>
    <p>
    {% if cellline.celllinecharacterizationhpscscorecard.hpsc_scorecard_reports.all %}
    Data analysis report: {% if not cellline.celllinecharacterizationhpscscorecard.hpsc_scorecard_reports.all.count == 1 %}<br/>{% endif %}
    {% for report in cellline.celllinecharacterizationhpscscorecard.hpsc_scorecard_reports.all %}
    <a href="{{ report.file_doc.url }}">{{ report.filename }}</a>{% if report.file_description %} - {{ report.file_description }}{% endif %}<br/>
    {% endfor %}
    {% endif %}
    {% if cellline.celllinecharacterizationhpscscorecard.hpsc_scorecard_files.all %}
    Scorecard: {% if not cellline.celllinecharacterizationhpscscorecard.hpsc_scorecard_files.all.count == 1 %}<br/>{% endif %}
    {% for report in cellline.celllinecharacterizationhpscscorecard.hpsc_scorecard_files.all %}
    <a href="{{ report.file_doc.url }}">{{ report.filename }}</a>{% if report.file_description %} - {{ report.file_description }}{% endif %}<br/>
    {% endfor %}
    {% endif %}
    </p>
  </td>
</tr>
{% endif %}

{% if cellline.celllinecharacterizationpluritest and cellline.celllinecharacterizationpluritest.pluripotency_score %}
<tr>
  <td class="label">PluriTest:</td>
  <td>
    Pluripotency score: {{ cellline.celllinecharacterizationpluritest.pluripotency_score }}
    {% if cellline.celllinecharacterizationpluritest.novelty_score %}
    <br/>Novelty score: {{ cellline.celllinecharacterizationpluritest.novelty_score }}
    {% endif %}
    {% if cellline.celllinecharacterizationpluritest.microarray_url %}
    <br/>Microarray data: <a href="{{ cellline.celllinecharacterizationpluritest.microarray_url }}" target="_blank">{{ cellline.celllinecharacterizationpluritest.microarray_url }}</a>
    {% endif %}

    {% if cellline.celllinecharacterizationpluritest.pluritest_files.all %}
    <br/>Report: {% if not cellline.celllinecharacterizationpluritest.pluritest_files.all.count == 1 %}<br/>{% endif %}
    {% for report in cellline.celllinecharacterizationpluritest.pluritest_files.all %}
    <a target="_blank" href="{{ report.file_doc.url }}">{{ report.filename }}</a>{% if report.file_description %} - {{ report.file_description }}{% endif %}<br/>
    {% endfor %}
    {% endif %}

    <div class="user-note">
      <p>The PluriTest is a pluripotency assessment based on DNA microarray data, which considers the genome-wide expression profile of the sample (<a href="http://www.nature.com/nmeth/journal/v8/n4/full/nmeth.1580.html" target="_blank">www.nature.com/nmeth/journal/v8/n4/full/nmeth.1580.html</a>).</p>

      <p>PluriTest scores should be assessed in the context of the empirical distribution of pluripotent and somatic samples used to construct and validate PluriTest (<i>e.g. <a href="https://www.ncbi.nlm.nih.gov/books/NBK133282/figure/assessmentofhumanpluripotent.F6/" target="_blank">Exemplary use of PluriTest</a></i>). The training set of iPSC clustered with pluripotency score > 25 and novelty score < 1.67  with 98% sensitivity and 100% specificity.  Cell lines with pluritest scores > 10 also cluster with the PluriTest training data set with high sensitivy and specificity.</p>
    </div>
  </td>
</tr>
{% endif %}

{% if cellline.undifferentiated_morphology_files.all %}
<tr>
  <td class="label">Morphology:</td>
  <td>
    {% for file in cellline.undifferentiated_morphology_files.all %}
    <!-- Images -->
    {% if file.extension in '.jpg,.JPG,.jpeg,.JPEG,.png,.PNG,.gif,.GIF'|slice:',' %}
    {% thumbnail file.file_doc "250" as img %}
    <p><a href="{{ file.file_doc.url }}" target="_blank"><img src="{{ img.url }}" width="{{ img.width }}" height="{{ img.height }}"></a>
    {% endthumbnail %}
    {% if file.file_description %}<br/>{{ file.file_description }}{% endif %}
    </p>
    <!-- Not images -->
    {% else %}
    <p><a href="{{ file.file_doc.url }}" target="_blank">{{ file.filename }}</a>{% if file.file_description %} - {{ file.file_description }}{% endif %}
    </p>
    {% endif %}
    {% endfor %}
  </td>
</tr>
{% endif %}

{% endif %}
